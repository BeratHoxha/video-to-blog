# Plan: Video-to-Blog Web Application

**Status:** Ready for Approval
**Date:** 2026-02-21

---

## 1. Goal

Build a full-stack web application that transcribes video content (URL or file upload), generates structured blog articles via GPT-4o, and provides an authenticated dashboard with an AI-assisted rich text editor, article history, and export capabilities.

---

## 2. Context

- New project, no existing codebase.
- User preference: Ruby on Rails backend + React frontend.
- Rails is well-suited: background jobs (Sidekiq), Devise auth, Active Storage, and JSON APIs are all first-class.
- React (via Vite, mounted in Rails) is appropriate for the interactive editor, animation, and component reuse (Engine component shared across landing + dashboard).
- The Engine component must behave identically in layout on both the landing page and the authenticated dashboard — only behavior differs by auth state.

---

## 3. Scope

### Phase 1 (this plan)

- Rails + React project scaffold
- Authentication: Devise + OmniAuth (Google, GitHub)
- Landing page with all 6 sections
- Engine component (shared, auth-aware)
- Unauthenticated funnel: ~300-word streaming generation into modal
- Onboarding flow (post-signup)
- Authenticated dashboard with left sidebar (word + AI Bot usage)
- Article generation with SSE streaming into TipTap editor
- AI Bot: highlight-to-prompt inline co-writing, with free tier call limit
- Article history (list + re-open into editor)
- Export: Copy, PDF, DOCX, PPTX
- Video transcription: YouTube transcript API (primary), OpenAI Whisper (fallback)
- File upload: Active Storage + S3
- Newsletter signup (email capture, stored in DB)
- Pricing section (UI only, no payment processing)

### Out of Scope (Phase 1)

- Payment processing
- Video hosting or transcoding
- Social sharing
- Team/collaboration features
- Mobile native app
- Email delivery service (newsletter emails)
- Deployment configuration

---

## 4. Non-Goals

- No Stripe or payment gateway integration.
- No video storage — URL-based transcription or Whisper on uploaded file, then discard.
- No admin panel.
- No internationalization.

---

## 5. Requirements

### Functional

| # | Requirement |
|---|-------------|
| F1 | Landing page renders Engine section at top with H1 "Video to Blog" |
| F2 | Engine accepts video URL or file drop |
| F3 | Engine options: Output Type (9 options), Output Format (4), Include Images toggle, Use External Links toggle, Additional Instructions textarea |
| F4 | Unauthenticated generation streams ~300 words into a modal via SSE |
| F5 | Modal shows "Sign Up for More" section after generation completes |
| F6 | Landing page sections: Demo Video, How to Use, What We Offer, Pricing (3 tiers), Newsletter Signup |
| F7 | Signup with email/password, Google OAuth, GitHub OAuth via Devise + OmniAuth |
| F8 | Post-signup onboarding: use-case selection + plan selection (UI only) |
| F9 | Authenticated dashboard: left sidebar with word usage + AI Bot call counter |
| F10 | Authenticated generation streams full article (up to tier limit) into TipTap editor |
| F11 | TipTap editor: highlight selection triggers right-side AI Bot panel |
| F12 | AI Bot panel: prompt input + Apply button → replaces selection in editor |
| F13 | Free users: 10 AI Bot calls/week, visible counter, upgrade prompt at limit |
| F14 | Export: copy to clipboard, download as PDF / DOCX / PPTX |
| F15 | Article history: list view with title, date, word count |
| F16 | Article history: click to re-open in editor with original source pre-loaded |
| F17 | Newsletter signup: email capture stored to DB |
| F18 | Output Format options visible but locked (greyed + tooltip) for unauthenticated users |

### Non-Functional

- Streaming must deliver first token within 2 seconds of generation start.
- Editor must handle articles up to 10,000 words without degrading.
- Auth state must be checked server-side on all API routes.

---

## 6. Assumptions

- OpenAI API key available in environment.
- S3 bucket and credentials available in environment.
- Google and GitHub OAuth app credentials available in environment.
- YouTube URLs are the primary input; Whisper handles all non-YouTube inputs (uploaded files + non-YouTube URLs).
- Article title is auto-generated by GPT-4o as part of the generation prompt.
- "Billing period" for word usage = calendar month (resets on the 1st).
- AI Bot weekly call counter resets every Monday.
- Pricing tier values (amounts) are placeholders — to be replaced before launch.
- PDF/DOCX/PPTX export is generated server-side from the article HTML content.

---

## 7. Design System

### Brand

- **Product name**: Video To Blog
- **Tagline**: "Turn any video into a polished blog post — in seconds."
- **Logo**: Text-based wordmark for Phase 1. "Video To Blog" in Inter Bold, accent-colored dot or slash as separator (e.g., `Video·Blog`). SVG slot reserved for future logo asset.

### Visual Identity

| Token | Value |
|-------|-------|
| Background (page) | `gray-950` (#030712) |
| Background (surface/card) | `gray-900` (#111827) |
| Background (raised) | `gray-800` (#1f2937) |
| Border | `gray-700` (#374151) |
| Accent (primary) | `emerald-500` (#10b981) |
| Accent (hover) | `emerald-400` (#34d399) |
| Accent (glow) | `emerald-500` at 20% opacity |
| Text (primary) | `white` |
| Text (secondary) | `gray-400` (#9ca3af) |
| Text (muted) | `gray-600` (#4b5563) |
| Font | Inter (400, 500, 600, 700) via Google Fonts |
| Border radius | `rounded-xl` (12px) for cards, `rounded-lg` (8px) for inputs |

### Design Principles

1. **Clarity first**: Every section must answer one question. The hero answers "what is this?" The How-to-Use answers "how do I start?" The pricing answers "what do I get?". No decorative sections.
2. **Show, don't tell**: The Engine is the first thing you see — not a hero image, not a marketing paragraph. The product speaks for itself.
3. **Generous whitespace**: Dense content feels untrustworthy. Sections breathe. Line heights are relaxed.
4. **Accent with restraint**: Emerald is used on CTAs, active states, and key data points only. Most of the UI is dark neutrals.
5. **Motion is purposeful**: Animations communicate state (loading, generating, complete). No decorative animations.

### Component Library

**shadcn/ui** (Radix UI primitives + Tailwind) with the dark theme configured. Components to use:
- `Button` (default + outline + ghost variants)
- `Dialog` / `Sheet` (modal and AI Bot panel)
- `Select` (output type dropdown)
- `Toggle` / `Switch` (include images, use external links)
- `Textarea` (additional instructions)
- `Badge` (tier indicators, usage counters)
- `Progress` (word usage bar)
- `Tooltip` (locked features, usage explanations)
- `DropdownMenu` (export options)
- `Card` (pricing cards, article history items)
- `Skeleton` (loading states while job processes)
- `Avatar` (user profile in nav)

Additional: **Framer Motion** for animation.

---

### Landing Page — Section-by-Section Design

#### Navigation (sticky)
- Logo left, nav links center (Demo, How it works, Pricing), auth buttons right (Sign in | Get started).
- Background: `gray-950/80` with `backdrop-blur-md`. Subtle `border-b border-gray-800`.
- On scroll: border becomes visible.

#### Section 1: Engine (Hero + Tool)
- No separate marketing hero. The tool **is** the hero.
- Above the engine: a small eyebrow label in emerald (`✦ Free to try — no signup required`) + H1: `"Turn any video into a polished blog post."` in 56px Inter Bold, white. Subheadline in gray-400: `"Paste a URL or drop a file. Choose your style. Get a blog post in seconds."`
- Engine card: `gray-900` background, `border border-gray-700`, `rounded-2xl`, subtle `shadow-2xl`. Emerald glow on focus states.
- "Generate" button: full-width, `bg-emerald-500 hover:bg-emerald-400`, large (h-12), rounded-lg.
- Locked options (unauthenticated): greyed with a `Lock` icon + tooltip "Sign up to unlock".

#### Section 2: Demo Video
- Dark card with rounded corners. Placeholder: gray-800 rectangle with a centered play button (emerald circle, white triangle).
- Label above: `"See it in action"` in eyebrow style.

#### Section 3: How to Use
- 5 numbered steps in a horizontal row (desktop) / vertical stack (mobile).
- Each step: large emerald step number, bold title, short gray description.
- Step numbers use a large outlined emerald circle.

#### Section 4: What We Offer
- 3-column feature grid. Each feature card: `gray-900` bg, border, icon in emerald, title in white, description in gray-400.
- Features: (1) Video → Blog in seconds, (2) AI co-writing editor, (3) Article history & workspace.

#### Section 5: Pricing
- 3 cards (Free, Basic, Premium). Basic card is visually elevated: `border-emerald-500`, `ring-1 ring-emerald-500/30`, `shadow-emerald-500/10`. "Most Popular" badge above it.
- Each card: tier name, price (placeholder), feature list with checkmarks in emerald, CTA button.
- Free card CTA: "Get started free" (outline). Basic: "Start with Basic" (filled emerald). Premium: "Go Premium" (outline).

#### Section 6: Newsletter
- Centered, full-width dark section. Headline + email input + "Subscribe" button side by side.
- Subtext: `"No spam. Just updates when we ship something worth seeing."`

---

### Generation Modal (Unauthenticated)

- Full-screen `Dialog` with dark overlay.
- Header: "Your article preview" + close button.
- Body: white text on `gray-900` bg, article content typed in with typewriter animation (cursor blink in emerald).
- Once complete: a subtle divider, then the "Sign up for more" panel slides up with benefit list (emerald checkmarks) and two CTA buttons: "Sign up free" (filled) + "See pricing" (ghost).

---

### Dashboard Design

#### Layout
- Left sidebar (240px, fixed): Logo, nav items (New Article, History), usage stats at bottom.
- Main content: Engine + Editor, full remaining width.
- Right panel (AI Bot): slides in as a `Sheet` when text is highlighted, 320px wide.

#### Left Sidebar
- Background: `gray-900`, `border-r border-gray-800`.
- Usage stats section at bottom: word usage progress bar (emerald fill), label "1,240 / 2,000 words used". AI Bot calls badge for free users: "6 / 10 AI rewrites left this week".
- Upgrade CTA for free users: small `Card` with "Unlock unlimited words" + "Upgrade" button.

#### Editor
- TipTap renders on `gray-950` bg (same as page). Text: white, 18px, relaxed line-height.
- Cursor: standard text cursor.
- Toolbar: minimal — only Bold, Italic, Heading levels, and a copy icon. Appears above editor.
- On text selection: a floating emerald highlight bar appears with "Rewrite with AI →" button that opens the AI Bot panel.

#### AI Bot Panel (right Sheet)
- Header: "AI Co-writer"
- Selected text shown in a gray-800 quote block.
- Prompt input: `"What should I change?"` placeholder.
- Quick suggestion chips: "Make it shorter", "More professional", "Simplify language", "Add more detail".
- "Apply" button: emerald, full-width.
- Free user call counter: `"3 of 10 rewrites remaining this week"` in small muted text.

---

### Responsive Behavior

- Mobile: Engine stacks vertically, options panel collapses into accordion. Nav becomes hamburger menu.
- Tablet: 2-column layout where relevant, sidebar becomes a bottom sheet.
- Desktop: Full layout as described.

---

## 7b. Approach

### Tech Stack

| Layer | Choice | Reason |
|-------|--------|--------|
| Backend | Ruby on Rails 7.2 (API mode disabled — full stack) | SSE streaming, Devise, Active Storage, background jobs all first-class |
| Frontend | React 18 + Vite (via `vite_rails` gem) | Component reuse, TipTap integration, fast HMR |
| Styling | Tailwind CSS | Utility-first, fast UI iteration |
| Auth | Devise + OmniAuth (Google, GitHub) | Standard Rails auth, easy OAuth |
| Database | PostgreSQL | Full-text search later, JSON columns, reliable |
| Background Jobs | Sidekiq + Redis | Async Whisper transcription, file processing |
| File Storage | Active Storage + AWS S3 | Rails native, handles video uploads |
| Streaming | Background job (Sidekiq) + polling + frontend typewriter animation | Full article generated server-side, animated client-side — simpler than SSE, no open HTTP connection required |
| UI Components | shadcn/ui (dark theme) | Radix primitives + Tailwind, accessible, full design control |
| Animation | Framer Motion | Typewriter effect, modal transitions, panel slide-ins |
| Rich Text Editor | TipTap (React) | Best selection API, streaming-compatible, ProseMirror-based |
| Transcription | `youtube-transcript` gem + OpenAI Whisper API | YouTube-first, Whisper fallback |
| Article Gen | OpenAI GPT-4o via `ruby-openai` gem | Streaming support, strong instruction-following |
| Export | `prawn` (PDF), `caracal` (DOCX), `caxlsx` / custom (PPTX) | Server-side generation from HTML |

### Architecture Overview

```
Browser (React + TipTap)
  ↕ JSON API + SSE
Rails Application
  ├── Devise Auth (sessions)
  ├── API Controllers (articles, generations, ai_bot)
  ├── Services
  │   ├── TranscriptionService (YouTube → Whisper fallback)
  │   ├── ArticleGenerationService (OpenAI streaming)
  │   ├── AIBotService (OpenAI inline rewrite)
  │   └── ExportService (PDF / DOCX / PPTX)
  ├── Models (User, Article, NewsletterSubscription)
  └── Active Storage (video file uploads → S3)
```

### Generation Flow (Background + Typewriter Animation)

1. React submits generation request (`POST /api/generations`) → Rails returns `{ generation_id, status: "processing" }` immediately.
2. Rails enqueues `ArticleGenerationJob` (Sidekiq):
   - Runs `TranscriptionService` (YouTube → Whisper fallback).
   - Calls `ArticleGenerationService` → full GPT-4o response (no streaming).
   - Saves article to DB with `status: "complete"`.
3. React polls `GET /api/generations/:id/status` every 2 seconds.
4. When status is `"complete"`, React receives the full article content.
5. React plays a **typewriter animation** — renders characters progressively using a JS interval (e.g., 15ms per character or word-by-word at 80wpm equivalent), inserting into TipTap.
6. Once animation completes, TipTap becomes fully editable.

**Why not SSE:** Avoids `ActionController::Live`, keeps HTTP connections short-lived, and makes generation jobs retriable/inspectable via Sidekiq. Animation is indistinguishable from real streaming to the user.

### Engine Component (Shared)

- Single React component: `<VideoToBlogEngine />`
- Props: `authenticated: boolean`, `userTier: string | null`
- When `authenticated: false`: output format options rendered but disabled, AI Bot unavailable, result goes to modal (capped at 300 words).
- When `authenticated: true`: full behavior, results stream into TipTap editor below engine.

---

## 8. File Changes (New Project)

### Directory Structure

```
video-to-blog/
├── app/
│   ├── controllers/
│   │   ├── application_controller.rb
│   │   ├── pages_controller.rb          # Landing page
│   │   ├── dashboard_controller.rb
│   │   ├── onboarding_controller.rb
│   │   └── api/
│   │       ├── generations_controller.rb  # POST + SSE stream
│   │       ├── ai_bot_controller.rb       # Inline rewrite
│   │       ├── articles_controller.rb     # CRUD + export
│   │       └── newsletter_controller.rb   # Email capture
│   ├── models/
│   │   ├── user.rb
│   │   ├── article.rb
│   │   └── newsletter_subscription.rb
│   ├── services/
│   │   ├── transcription_service.rb
│   │   ├── article_generation_service.rb
│   │   ├── ai_bot_service.rb
│   │   └── export_service.rb
│   ├── jobs/
│   │   └── transcription_job.rb
│   └── views/
│       ├── layouts/application.html.erb
│       ├── pages/home.html.erb            # Landing page shell
│       └── dashboard/index.html.erb       # Dashboard shell
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   ├── Engine/
│   │   │   │   ├── VideoToBlogEngine.tsx
│   │   │   │   ├── UrlInput.tsx
│   │   │   │   ├── FileDropZone.tsx
│   │   │   │   └── OptionsPanel.tsx
│   │   │   ├── Editor/
│   │   │   │   ├── ArticleEditor.tsx
│   │   │   │   └── AIBotPanel.tsx
│   │   │   ├── Modal/
│   │   │   │   ├── GenerationModal.tsx    # Unauthenticated result
│   │   │   │   └── SignUpPrompt.tsx
│   │   │   ├── Landing/
│   │   │   │   ├── Nav.tsx
│   │   │   │   ├── HeroEyebrow.tsx
│   │   │   │   ├── DemoVideo.tsx
│   │   │   │   ├── HowToUse.tsx
│   │   │   │   ├── WhatWeOffer.tsx
│   │   │   │   ├── PricingSection.tsx
│   │   │   │   └── NewsletterSignup.tsx
│   │   │   ├── Dashboard/
│   │   │   │   ├── Sidebar.tsx
│   │   │   │   └── ArticleHistory.tsx
│   │   │   └── shared/
│   │   │       └── TypewriterText.tsx
│   │   ├── hooks/
│   │   │   ├── useGenerationPoller.ts   # Polls status, fires when complete
│   │   │   ├── useTypewriter.ts         # Animates full text into editor
│   │   │   └── useAIBot.ts
│   │   ├── pages/
│   │   │   ├── LandingPage.tsx
│   │   │   └── DashboardPage.tsx
│   │   ├── lib/
│   │   │   ├── utils.ts               # shadcn cn() helper
│   │   │   └── tokens.ts              # design token constants
│   │   ├── styles/
│   │   │   └── globals.css            # Tailwind base + shadcn CSS vars
│   │   └── main.tsx
│   └── vite.config.ts
├── db/
│   └── migrate/
│       ├── XXXXXX_create_users.rb          # (via Devise)
│       ├── XXXXXX_add_onboarding_to_users.rb
│       ├── XXXXXX_create_articles.rb
│       └── XXXXXX_create_newsletter_subscriptions.rb
├── spec/
│   ├── models/
│   │   ├── user_spec.rb
│   │   └── article_spec.rb
│   ├── services/
│   │   ├── transcription_service_spec.rb
│   │   ├── article_generation_service_spec.rb
│   │   ├── ai_bot_service_spec.rb
│   │   └── export_service_spec.rb
│   └── requests/
│       ├── api/generations_spec.rb
│       ├── api/ai_bot_spec.rb
│       └── api/articles_spec.rb
├── Gemfile
├── package.json
├── vite.config.ts
└── README.md
```

### Database Schema

**users**
```
id, email, encrypted_password, name, provider, uid,
use_case (string), plan (enum: free/basic/premium),
words_used_this_month (integer, default: 0),
ai_bot_calls_this_week (integer, default: 0),
ai_bot_calls_reset_at (datetime),
words_reset_at (datetime),
created_at, updated_at
```

**articles**
```
id, user_id,
title (string),
content (text),                    # HTML from TipTap
source_url (string),
source_type (enum: url/file),
output_type (string),
output_format (string),
include_images (boolean),
use_external_links (boolean),
additional_instructions (text),
word_count (integer),
status (enum: processing/complete/failed, default: processing),
created_at, updated_at
```

**newsletter_subscriptions**
```
id, email (string, unique), created_at
```

---

## 9. Edge Cases

| Case | Handling |
|------|----------|
| YouTube video has no transcript | Fall through to Whisper; if video file not available, return error to user |
| User hits word limit mid-generation | Stop SSE stream at limit, save partial article, show upgrade prompt |
| User hits AI Bot weekly limit | Return 403 with upgrade prompt message; do not consume a call |
| SSE connection drops mid-stream | Article not saved; user sees error; can retry |
| File upload exceeds size limit | Reject at Rails level (set limit to 500MB), return clear error |
| Non-YouTube URL provided | Attempt Whisper; if URL not downloadable, return error |
| TipTap editor empty on export | Disable export buttons; show "Nothing to export" message |
| OAuth user tries email/password login | Devise handles gracefully; show "Sign in with Google/GitHub" |
| Free user selection of paid export format | Format shown greyed with tooltip; Generate button locks export option |

---

## 10. Test Plan

Each spec file is small and focused on a single unit.

### Model Specs

**user_spec.rb**
- `#ai_bot_calls_remaining` returns correct count for free users
- `#ai_bot_calls_remaining` returns nil for basic/premium users
- `#words_remaining` returns correct count for free users
- `#words_remaining` returns nil for unlimited users
- `#reset_ai_bot_calls_if_needed!` resets counter when a week has passed
- `#reset_words_if_needed!` resets counter when a new month starts

**article_spec.rb**
- Validates presence of user, content
- `#word_count` is calculated on save
- Scopes: `recent`, `for_user`

### Service Specs

**transcription_service_spec.rb**
- Returns transcript string for a valid YouTube URL (stub HTTP)
- Falls through to Whisper if YouTube transcript unavailable (stub)
- Raises `TranscriptionError` for unsupported/inaccessible URLs

**article_generation_service_spec.rb**
- Calls OpenAI with correct prompt structure (stub OpenAI)
- Returns full article string
- Truncates content to word limit for free/unauthenticated users
- Includes correct system prompt based on output type

**ai_bot_service_spec.rb**
- Returns rewritten selection string (stub OpenAI)
- Raises `AIBotLimitError` when user is at limit
- Does not increment counter on error

**export_service_spec.rb**
- Returns binary PDF blob for valid article content
- Returns DOCX blob
- Returns PPTX blob
- Raises `ExportError` for empty content

### Request Specs

**api/generations_spec.rb**
- POST `/api/generations` — unauthenticated → 200, enqueues job, returns `generation_id`
- GET `/api/generations/:id/status` — returns `{ status: "processing" }` while job runs
- GET `/api/generations/:id/status` — returns `{ status: "complete", content: "...", word_count: N }` when done
- POST `/api/generations` — unauthenticated → completed article content capped at ~300 words
- POST `/api/generations` — authenticated free → capped at 2,000 words
- POST `/api/generations` — authenticated basic → no word cap applied
- POST `/api/generations` — missing URL and no file → 422

**api/ai_bot_spec.rb**
- POST `/api/ai_bot` — unauthenticated → 401
- POST `/api/ai_bot` — free user under limit → 200, returns rewritten text
- POST `/api/ai_bot` — free user at limit → 403 with upgrade message
- POST `/api/ai_bot` — basic user → 200 always

**api/articles_spec.rb**
- GET `/api/articles` — unauthenticated → 401
- GET `/api/articles` — returns only current user's articles
- GET `/api/articles/:id` — returns article with source pre-loaded
- DELETE `/api/articles/:id` — soft delete or hard delete, user-scoped

---

## 11. Risks

| Risk | Likelihood | Mitigation |
|------|-----------|------------|
| OpenAI API latency causes slow streaming start | Medium | Show "Processing..." state immediately; begin SSE connection before OpenAI call completes |
| Whisper transcription time for long videos | High | Run as Sidekiq background job; poll for completion or use SSE to notify when ready |
| TipTap streaming inserts causing editor flicker | Medium | Batch chunk inserts using `requestAnimationFrame`; insert in 50ms batches |
| S3 upload size / timeout for large video files | Medium | Use direct-to-browser presigned URL upload for files >10MB |
| Free user word counter desync on concurrent requests | Low | Use DB-level atomic increment (`UPDATE ... SET words_used = words_used + N`) |
| PPTX generation quality from HTML | Medium | Use a lightweight PPTX library; set expectations that slides are simple text-based |

---

## 12. Open Questions

None. All questions resolved before plan finalization:
- AI Provider: OpenAI GPT-4o
- Transcription: YouTube transcript API → Whisper fallback
- Auth: Devise + OmniAuth (Google, GitHub)
- Generation UX: Background job (Sidekiq) + polling + frontend typewriter animation (Framer Motion)
- Editor: TipTap
- File uploads: Active Storage + S3
- Deployment: Out of scope for Phase 1
- Design: Dark & Bold (gray-950 / emerald accent / Inter), shadcn/ui, Framer Motion
- Brand: "Video To Blog", text wordmark placeholder

---

## Approval

Reply with exactly: **YES** to approve this plan and proceed to `/implement_plan`.
